<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>سامانه شیفت شرکت معدنی و صنعتی گهرزمین</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --brand: #003087;
  --bg: #0f172a;
  --card: #1e293b;
  --text: #f8fafc;
  --highlight: #2563eb;
}
body {
  margin: 0;
  font-family: Tahoma, sans-serif;
  background-color: var(--bg);
  color: var(--text);
  position: relative;
}
body::before {
  content:"";
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: url('Gz.PNG') center/cover no-repeat;
  opacity:0.1;
  filter: blur(5px);
  z-index:0;
}
header {
  background-color: var(--brand);
  padding: 1rem;
  text-align: center;
  font-size: 1.5rem;
  font-weight: bold;
  position: relative;
  z-index:1;
}
.container {
  padding: 1rem;
  position: relative;
  z-index:1;
}
.unit-card, .shift-card, .detail-card {
  background-color: var(--card);
  margin-bottom: 1rem;
  padding: 1rem;
  border-radius: 0.5rem;
}
.unit-title, .shift-title {
  font-size: 1.2rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
  color: var(--highlight);
}
textarea {
  width: 100%;
  height: 60px;
  resize: vertical;
  background: white;
  color: black;
  border: 1px solid #ccc;
  padding: 0.4rem;
  margin-bottom:0.5rem;
}
button, input {
  padding: 0.4rem 0.8rem;
  border-radius: 0.25rem;
  border: none;
  margin:0.3rem 0;
}
.login-container {
  display:flex;
  flex-direction:column;
  max-width:300px;
  margin:2rem auto;
  background-color: var(--card);
  padding:1rem;
  border-radius:0.5rem;
  text-align:center;
  position: relative;
  z-index:1;
}
.login-container img {
  max-width:100px;
  margin-bottom:1rem;
}
.hidden { display:none; }
.back-btn {
  background-color: var(--highlight);
  color: white;
  padding: 0.4rem 0.8rem;
  border:none;
  border-radius:0.25rem;
  margin-bottom:1rem;
  cursor:pointer;
}
.unit-list button, .shift-list button {
  width: 100%;
  text-align: right;
  background-color: #334155;
  color: var(--text);
  margin:0.3rem 0;
  cursor:pointer;
}
</style>
</head>
<body>

<header>سامانه شیفت شرکت گهرزمین</header>

<!-- صفحه لاگین -->
<div id="loginPage" class="login-container">
  <img src="Gz.PNG" alt="لوگو">
  <div>ورود به سامانه شیفت شرکت گهرزمین</div>
  <input type="text" id="username" placeholder="نام کاربری">
  <input type="password" id="password" placeholder="رمز عبور">
  <button onclick="login()">ورود</button>
  <div id="loginMsg" style="color:red;"></div>
</div>

<!-- صفحه واحدها -->
<div id="unitsPage" class="container hidden">
  <button class="back-btn" onclick="goBackLogin()">بازگشت</button>
  <h3>انتخاب واحد</h3>
  <div class="unit-list" id="unitList"></div>
</div>

<!-- صفحه شیفت‌ها -->
<div id="shiftsPage" class="container hidden">
  <button class="back-btn" onclick="goBackUnits()">بازگشت</button>
  <h3 id="shiftUnitName">شیفت‌های واحد</h3>
  <div class="shift-list" id="shiftList"></div>
</div>

<!-- صفحه جزئیات شیفت -->
<div id="detailsPage" class="container hidden">
  <button class="back-btn" onclick="goBackShifts()">بازگشت</button>
  <h3 id="detailTitle">جزئیات شیفت</h3>
  <div class="detail-card" id="detailContent"></div>
</div>

<script>
// داده‌ها
const units = [
  { name:'واحد معدن', type:'general', shifts:[
    {name:'A', time:'07:00 - 15:00', supervisor:'آقای قاسمی', data:{FEO:0.008, رطوبت:'8%', بلین:1200}},
    {name:'B', time:'15:00 - 23:00', supervisor:'آقای طوسی', data:{FEO:0.009, رطوبت:'9%', بلین:1150}},
    {name:'C', time:'23:00 - 07:00', supervisor:'آقای ابراهیمی', data:{FEO:0.007, رطوبت:'7%', بلین:1180}},
    {name:'D', time:'استراحت', supervisor:'آقای ملکشاهی', data:{}}
  ]},
  { name:'واحد فرآوری و خردایش', type:'general', shifts:[
    {name:'A', time:'07:00 - 15:00', supervisor:'آقای قاسمی', data:{FEO:0.01, رطوبت:'10%', بلین:1250}},
    {name:'B', time:'15:00 - 23:00', supervisor:'آقای طوسی', data:{FEO:0.011, رطوبت:'9%', بلین:1230}},
    {name:'C', time:'23:00 - 07:00', supervisor:'آقای ابراهیمی', data:{FEO:0.009, رطوبت:'8%', بلین:1220}},
    {name:'D', time:'استراحت', supervisor:'آقای ملکشاهی', data:{}}
  ]},
  { name:'واحد گندله‌سازی', type:'general', shifts:[
    {name:'A', time:'07:00 - 15:00', supervisor:'آقای سعید', data:{FEO:0.008, رطوبت:'8%', بلین:1200}},
    {name:'B', time:'15:00 - 23:00', supervisor:'آقای نورمندی', data:{FEO:0.009, رطوبت:'9%', بلین:1150}},
    {name:'C', time:'23:00 - 07:00', supervisor:'آقای امامی', data:{FEO:0.007, رطوبت:'7%', بلین:1180}},
    {name:'D', time:'استراحت', supervisor:'آقای روح‌الامینی', data:{}}
  ]},
  { name:'واحد انرژی و سیالات', type:'energy', shifts:[
    {name:'A', time:'07:00 - 15:00', supervisor:'حسن', data:{برق:'80%', آب:'60%', گاز:'50%'}},
    {name:'B', time:'15:00 - 23:00', supervisor:'آقای نورمندی', data:{برق:'85%', آب:'62%', گاز:'52%'}},
    {name:'C', time:'23:00 - 07:00', supervisor:'آقای خواجویی', data:{برق:'78%', آب:'58%', گاز:'49%'}},
    {name:'D', time:'استراحت', supervisor:'آقای مجیدی', data:{}}
  ]},
  { name:'واحد آزمایشگاه', type:'general', shifts:[
    {name:'A', time:'07:00 - 15:00', supervisor:'آقای قاسمی', data:{FEO:0.008, رطوبت:'8%', بلین:1200}},
    {name:'B', time:'15:00 - 23:00', supervisor:'آقای طوسی', data:{FEO:0.009, رطوبت:'9%', بلین:1150}},
    {name:'C', time:'23:00 - 07:00', supervisor:'آقای ابراهیمی', data:{FEO:0.007, رطوبت:'7%', بلین:1180}},
    {name:'D', time:'استراحت', supervisor:'آقای ملکشاهی', data:{}}
  ]}
];

let isManager=false;
let currentUnit=null;
let currentShift=null;

// لاگین
function login(){
  const u=parseInt(document.getElementById('username').value);
  const p=document.getElementById('password').value;
  const msg=document.getElementById('loginMsg');
  if(p!=='123'){ msg.textContent='رمز عبور اشتباه است'; return; }
  if(u>=1 && u<=5){ isManager=true; }
  else if(u>=1000 && u<=1800){ isManager=false; }
  else{ msg.textContent='نام کاربری اشتباه است'; return; }

  document.getElementById('loginPage').classList.add('hidden');
  showUnitsPage();
}

// صفحات
function showUnitsPage(){
  const listDiv=document.getElementById('unitList');
  listDiv.innerHTML='';
  units.forEach((unit,idx)=>{
    const btn=document.createElement('button');
    btn.textContent=unit.name;
    btn.onclick=()=>{ currentUnit=idx; showShiftsPage(); };
    listDiv.appendChild(btn);
  });
  document.getElementById('unitsPage').classList.remove('hidden');
}

function showShiftsPage(){
  document.getElementById('unitsPage').classList.add('hidden');
  const listDiv=document.getElementById('shiftList');
  listDiv.innerHTML='';
  document.getElementById('shiftUnitName').textContent=units[currentUnit].name;
  units[currentUnit].shifts.forEach((shift,idx)=>{
    const btn=document.createElement('button');
    btn.textContent=`شیفت ${shift.name} | ${shift.time} | مسئول: ${shift.supervisor}`;
    btn.onclick=()=>{ currentShift=idx; showDetailsPage(); };
    listDiv.appendChild(btn);
  });
  document.getElementById('shiftsPage').classList.remove('hidden');
}

function showDetailsPage(){
  document.getElementById('shiftsPage').classList.add('hidden');
  const unit=units[currentUnit];
  const shift=unit.shifts[currentShift];
  const content=document.getElementById('detailContent');
  content.innerHTML=`<div class="shift-title">شیفت ${shift.name} | ${shift.time} | سرپرست: ${shift.supervisor}</div>`;
  if(isManager){
    content.innerHTML+=`<div>نظر مدیر: <textarea placeholder="نظر خود را وارد کنید"></textarea></div>`;
  } else{
    content.innerHTML+=`<div>نظر مدیر: در حال بروز رسانی</div>`;
  }

  if(unit.type==='general'){
    content.innerHTML+=`<div>FEO: ${shift.data.FEO}<br>رطوبت: ${shift.data.رطوبت}<br>بلین: ${shift.data.بلین}</div>`;
    content.innerHTML+=`<canvas id="chartFEO"></canvas>`;
  } else if(unit.type==='energy'){
    content.innerHTML+=`<div>برق: ${shift.data.برق}<br>آب: ${shift.data.آب}<br>گاز: ${shift.data.گاز}</div>`;
    content.innerHTML+=`<canvas id="chartEnergy"></canvas>`;
  }
  document.getElementById('detailsPage').classList.remove('hidden');

  // نمودار
  setTimeout(()=>{ // تا DOM کامل شود
    if(unit.type==='general'){
      new Chart(document.getElementById('chartFEO'),{
        type:'bar',
        data:{
          labels:['FEO','رطوبت','بلین'],
          datasets:[{label:'مقدار', data:[shift.data.FEO, parseFloat(shift.data.رطوبت), shift.data.بلین], backgroundColor:['#2563eb','#facc15','#ef4444']}]
        },
        options:{responsive:true, scales:{y:{beginAtZero:true}}}
      });
    } else if(unit.type==='energy'){
      new Chart(document.getElementById('chartEnergy'),{
        type:'bar',
        data:{
          labels:['برق','آب','گاز'],
          datasets:[{label:'مقدار', data:[parseFloat(shift.data.برق), parseFloat(shift.data.آب), parseFloat(shift.data.گاز)], backgroundColor:['#2563eb','#22c55e','#f59e0b']}]
        },
        options:{responsive:true, scales:{y:{beginAtZero:true}}}
      });
    }
  },100);
}

// دکمه بازگشت
function goBackLogin(){ document.getElementById('unitsPage').classList.add('hidden'); document.getElementById('loginPage').classList.remove('hidden'); }
function goBackUnits(){ document.getElementById('shiftsPage').classList.add('hidden'); showUnitsPage(); }
function goBackShifts(){ document.getElementById('detailsPage').classList.add('hidden'); showShiftsPage(); }
</script>
</body>
</html>
